<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8">
    <title>社交网络管理系统</title>
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="shortcut icon" href="../dist/img/2.jpg" type="image/x-icon" />
    <link href="../dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="../dist/css/1.css" rel="stylesheet">

    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script type="text/javascript" src="../dist/js/jquery/jquery.min.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="../dist/js/bootstrap/bootstrap.min.js"></script>
    <script src="../dist/js/1.js"></script>
</head>

<body>
<div class="topnav">
    <ul>
        <a class="active" href="../index.html"><span class="glyphicon glyphicon-home"></span> 主页</a>
        <a href="showstudent.html" target="_self">学生</a>
        <a href="showteacher.html">教师</a>
        <a href="showclass.html">班级</a>
        <a href="showmajor.html">专业</a>
        <a href="#about" style="float:right">关于 <span class="glyphicon glyphicon-info-sign"></span></a>
        <form id="logoutForm" action="/logout" method="post">
            <a href="#" style="float:right" onclick="alert('注销成功');document.getElementById('logoutForm').submit();">注销</a>
        </form>
    </ul>
</div>
<div class="row">
    <div class="panel-group col-sm-2" id="panelContainer">
        <div class="panel panel-default">
            <div id="header1" class="panel-heading" data-toggle="collapse" data-target="#sub1" data-parent="#panelContainer">
                <i class="glyphicon glyphicon-user"></i>
                <a href="#">学生管理</a>
                <span class="glyphicon glyphicon-triangle-right pull-right"></span>
            </div>
            <div id="sub1" class="collapse panel-collapse">
                <div class="panel-body">
                    <ul class="nav">
                        <li>
                            <a href="#" id="fileImport1">
                        <span class="glyphicon glyphicon-align-left" aria-hidden="true">
                        </span>学生信息录入</a>
                        </li>
                        <li>
                            <a href="../new/newstudent.html">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true">
                        </span>学生信息新增</a>
                        </li>
                        <li>
                            <a href = "javascript:" onclick="download1()">
                        <span class="glyphicon glyphicon-minus" aria-hidden="true">
                        </span>学生信息导出</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div id="header2" class="panel-heading" data-toggle="collapse" data-target="#sub2" data-parent="#panelContainer">
                <i class="glyphicon glyphicon-book"></i>
                <a href="#">教师管理</a>
                <span class="glyphicon glyphicon-triangle-right pull-right"></span>
            </div>
            <div id="sub2" class="collapse panel-collapse">
                <div class="panel-body">
                    <ul class="nav">
                        <li>
                            <a href="../show/showteacher.html">
                        <span class="glyphicon glyphicon-align-left" aria-hidden="true">
                        </span>教师信息录入</a>
                        </li>
                        <li>
                            <a href="../new/newteacher.html">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true">
                        </span>教师信息新增</a>
                        </li>
                        <li>
                            <a href="../show/showteacher.html">
                        <span class="glyphicon glyphicon-minus" aria-hidden="true">
                        </span>教师信息导出</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div id="header3" class="panel-heading" data-toggle="collapse" data-target="#sub3" data-parent="#panelContainer">
                <i class="glyphicon glyphicon-list-alt"></i>
                <a href="#">班级管理</a>
                <span class="glyphicon glyphicon-triangle-right pull-right"></span>
            </div>
            <div id="sub3" class="collapse panel-collapse">
                <div class="panel-body">
                    <ul class="nav">
                        <li>
                            <a href="../show/showclass.html">
                        <span class="glyphicon glyphicon-align-left" aria-hidden="true">
                        </span>班级信息录入</a>
                        </li>
                        <li>
                            <a href="../new/newclass.html">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true">
                        </span>班级信息新增</a>
                        </li>
                        <li>
                            <a href="../show/showclass.html">
                        <span class="glyphicon glyphicon-minus" aria-hidden="true">
                        </span>班级信息导出</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div id="header4" class="panel-heading" data-toggle="collapse" data-target="#sub4" data-parent="#panelContainer">
                <i class="glyphicon glyphicon-leaf"></i>
                <a href="#">专业管理</a>
                <span class="glyphicon glyphicon-triangle-right pull-right"></span>
            </div>
            <div id="sub4" class="collapse panel-collapse">
                <div class="panel-body">
                    <ul class="nav">
                        <li>
                            <a href="../show/showmajor.html">
                        <span class="glyphicon glyphicon-align-left" aria-hidden="true">
                        </span>专业信息录入</a>
                        </li>
                        <li>
                            <a href="../new/newmajor.html">
                        <span class="glyphicon glyphicon-plus" aria-hidden="true">
                        </span>专业信息新增</a>
                        </li>
                        <li>
                            <a href="../show/showmajor.html">
                        <span class="glyphicon glyphicon-minus" aria-hidden="true">
                        </span>专业信息导出</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-10">
        <ol class="breadcrumb">
            <li class="active">菜单
            </li>
            <li class="active">学生列表
            </li>
        </ol>

        <div class="panel panel-default">
            <div class="panel-heading">
                <span class="glyphicon glyphicon-search"></span>  搜索
            </div>
            <div class="panel-body">
                <form role="search" class="navbar-form" id="search">
                    <div class="form-group">
                        <input type="text"  placeholder="Search" class="form-control" name="search">
                    </div>
                    <button class="btn btn-default" type="submit">Search</button>
                    <div  style="float:right;" class="btn btn-default btn-success" onclick="download()">导出</div>
                    <div  style="float:right;" class="btn btn-default btn-info" id="fileImport">导入</div>
                    <div style="float:right;" class="btn btn-default btn-toolbar" onclick="window.location.href='../new/newstudent.html'">新增</div>
                </form>
            </div>
        </div>
        <!--列表展示-->
        <div class="table-responsive">
            <!--            <div class="panel-heading">Search Results</div>-->
            <table id="results" class="table table-striped table-hover">
                <thead>
                <tr>
                    <th width="100">学号</th>
                    <th width="100">姓名</th>
                    <th width="100">性别</th>
                    <th width="100">出生日期</th>
                    <th width="100">所属班级</th>
                    <th width="60">操作</th>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
<!--        <ul class="pagination" style="float: right;">-->
<!--            <li><a href="#">&laquo;</a>-->
<!--            </li>-->
<!--            <li class="active"><a href="#">1</a>-->
<!--            </li>-->
<!--            <li class="disabled"><a href="#">2</a>-->
<!--            </li>-->
<!--            <li><a href="#">3</a>-->
<!--            </li>-->
<!--            <li><a href="#">4</a>-->
<!--            </li>-->
<!--            <li><a href="#">5</a>-->
<!--            </li>-->
<!--            <li><a href="#">&raquo;</a>-->
<!--            </li>-->
<!--        </ul>-->
    </div>
    <form action="/student/exportList" id="exportExcle" method="POST">
        <input type="hidden" name="dataTable" id="dataTable">
    </form>
    <input type="file" id="file" onchange="getFilePath()"
           style="filter:alpha(opacity=0);opacity:0;width: 0;height: 0;"/>
    <!--    <div class="col-md-5">-->
    <!--        <div class="panel panel-default">-->
    <!--            <div class="panel-heading" id="name">Details</div>-->
    <!--            <div class="row">-->
    <!--                <div class="col-sm-4 col-md-4">-->
    <!--                    <img src="" class="well" id="poster"/>-->
    <!--                </div>-->
    <!--                <div class="col-md-8 col-sm-8">-->
    <!--                    <h4>Crew</h4>-->
    <!--                    <ul id="crew">-->
    <!--                    </ul>-->
    <!--                </div>-->
    <!--            </div>-->
    <!--        </div>-->
    <!--    </div>-->
</div>

<!--<script src="http://d3js.org/d3.v3.min.js" type="text/javascript"></script>-->
<script type="text/javascript">
    $(function () {
        // function showStudent(name) {
        //     $.get("/students/search/findByName?name=" + encodeURIComponent(name), //固定参数 todo fix paramter in SDN
        //         function (data) {
        //             if (!data) return;
        //             var student = data;
        //             $("#name").text(student.name);
        //         }, "json");
        //     return false;
        //     }
        function search() {
            //$(this) 表示对当前HTML元素进行操作
            //$(“#abc”) 表示对id为abc的元素进行操作
            //$(“.abc”) 表示对class=”abc”的进行操作
            const query = $("#search").find("input[name=search]").val();
            //$.get("/student/search/findByNameLike?name=*" + encodeURIComponent(query) + "*",
            $.get("/student/query?name=*" + encodeURIComponent(query) + "*",
                function (data) {
                    const t = $("table#results tbody").empty();
                    if (!data) return;
                    //alert("Data: " + data + "\nStatus: " + status);
                    //data = data["_embedded"].students;
                    data.forEach(function (student) {
                        $("<tr><td class='student_id'>" + student.student_id + "</td><td class='student'>" + student.name + "</td><td>" + student.gender + "</td><td>"
                            + student.birth + "</td><td>"  + student.clazz + "</td><td>"  +
                            "<button type=\"button\" class=\"btn btn-default btn-warning edit\" data-toggle=\"modal\" data-target=\"#myEdit\" onclick=\"edit(this);\">编辑</button>"+
                            "<button type=\"button\" class=\"btn btn-default btn-danger del\" onclick=\"del(this)\" ;>删除</button></td>" + "</tr>").appendTo(t)
                        //.click(function() { showStudent($(this).find("td.student").text());})
                    });
                    //showStudent(data[0].name);
                }, "json");
            return false;
        }

        $("#search").submit(search);
        search();
    });
    $("#fileImport1").click(function () {
        $("#file").click();
    });
    //点击导入按钮,使files触发点击事件,然后完成读取文件的操作
    $("#fileImport").click(function () {
        $("#file").click();
    });
    function getFilePath(){
        //获取读取我文件的File对象
        const file = document.getElementById('file').files[0];
        const formData = new FormData();
        formData.append('file',file);
        $.ajax({
            url: "/student/importList",
            type: "POST",
            data: formData,
            contentType: false,
            processData: false,
            dataType: "text",
            async: true,
            success: function (data) {
                console.log(data);
                alert("导入成功");
                location.reload()
            },
            error: function () {
                alert("数据发送失败");
            }
        });
    }

    function edit(obj){
        const res = confirm('确认要编辑吗？');
        const name = $(obj).parents("tr").find(".student").eq(0).html();
        // var arr = {};
        // alert($(obj).parents("tr").html());
        //     // $(obj).parents("tr")
        // //获取最后一个td前面所有的td节点
        // var val=$(this).parent().prevAll();
        // alert(val);
        // var arr=[];
        // //通过循环将所有td里面的文本放到数组里面
        // for(var i=0;i<val.length;i++){
        //     arr[arr.length]=val.eq(i).text();
        // };
        // alert(arr[1].html());
        // //得到的arr数组与表格顺序相反
        // //将arr数组逆序与表格顺序相同，以便依次填到input中
        // var arr1=arr.reverse();
        // //for(var j=0;j<$('form input').length;j++){
        // for(var j=0;j<4;j++){
        //     //$('form input').eq(j).val(arr1[j])
        //     alert(arr1[j].html());
        // };
        if(res === true) {
            window.location.href="../edit/editstudent.html?name="+name;
        }
    }
    function del(obj){
        const res = confirm('确认要删除吗？');
        //$(obj).parents("tr").css('background-color','red');
        const name1 = $(obj).parents("tr").find(".student").eq(0).html();
        if(res === true) {
            $(obj).parents("tr").remove();         //前端删除整行
            $.ajax({
                url: "/student/delete",                //提交到的url
                type: "POST",                      //数据提交方式(post/get)
                //data: JSON.stringify(data),
                data: {
                    "name":name1
                },
                //contentType: "application/json;charset=UTF-8",   //缺失会出现URL编码，无法转成json对象
                contentType: "application/x-www-form-urlencoded;charset=UTF-8",
                //后台返回的json数据是一个纯String类型的对象时，前端dataType属性设置为json后，会认为这个由String对象转换的json数据格式不是标准的json格式，所以就去执行error对应的方法了。
                //dataType: "json",  //返回值数据类型
                dataType: "text",
                async: true, // 默认设置下，所有请求均为异步请求。如果设置为false，则发送同步请求
                // 请求成功后的回调函数。
                success: function (data) {  //此处data为服务器返回的数据
                    console.log(data);
                    alert("删除成功");
                },
                // 请求出错时调用的函数
                error: function () {
                    alert("数据发送失败");
                }
            });
        }
    }

</script>

<script type="text/javascript">
    // var width = 800, height = 800;
    //
    // var force = d3.layout.force()
    //     .charge(-200).linkDistance(30).size([width, height]);
    //
    // var svg = d3.select("#graph").append("svg")
    //     .attr("width", "100%").attr("height", "100%")
    //     .attr("pointer-events", "all");
    //
    // d3.json("/graph", function(error, graph) {
    //     if (error) return;
    //
    //     force.nodes(graph.nodes).links(graph.links).start();
    //
    //     var link = svg.selectAll(".link")
    //         .data(graph.links).enter()
    //         .append("line").attr("class", "link");
    //
    //     var node = svg.selectAll(".node")
    //         .data(graph.nodes).enter()
    //         .append("circle")
    //         .attr("class", function (d) { return "node "+d.label })
    //         .attr("r", 10)
    //         .call(force.drag);
    //
    //     // html name attribute
    //     node.append("name")
    //         .text(function (d) { return d.name; })
    //
    //     // force feed algo ticks
    //     force.on("tick", function() {
    //         link.attr("x1", function(d) { return d.source.x; })
    //             .attr("y1", function(d) { return d.source.y; })
    //             .attr("x2", function(d) { return d.target.x; })
    //             .attr("y2", function(d) { return d.target.y; });
    //
    //         node.attr("cx", function(d) { return d.x; })
    //             .attr("cy", function(d) { return d.y; });
    //     });
    // });
</script>
<!-- 底部页脚部分 -->
<div class="footer">
    <p class="text-center">
        2020 &copy; Odin.
    </p>
</div>
</body>
</html>
